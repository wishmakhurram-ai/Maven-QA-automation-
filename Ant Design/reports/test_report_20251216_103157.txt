================================================================================
TEST EXECUTION REPORT
================================================================================

Start Time: 2025-12-16 10:28:27
End Time: 2025-12-16 10:31:57
Duration: 0:03:30.076449

TOTAL TESTS: 7
PASSED: 6
FAILED: 1
SKIPPED: 0

================================================================================
PASSED TESTS:
================================================================================
1. test_admin_users_can_navigate_to_dedicated_admin_portal_login_page
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 38.35s

2. test_login_page_displays_email_and_password_fields
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 39.97s

3. test_forgot_password_link_redirects_to_password_reset_flow
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 29.50s

4. test_admin_lands_on_admin_panel_dashboard__firms_view_by_default
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 71.05s

5. test_admin_can_access_firms_section_and_view_firms_list
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 12.95s

6. test_admin_can_access_users_section_and_view_users_list_readonly
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 13.63s

================================================================================
FAILED TESTS:
================================================================================
1. test_firms_list_displays_all_required_columns
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 2.01s
   Error:
fixturefunc = <function step_see_table_with_columns at 0x000001CA70193A60>
request = <FixtureRequest for <Function test_firms_list_displays_all_required_columns>>
kwargs = {'context': <conftest.context.<locals>.Context object at 0x000001CA70655340>}

    def call_fixture_func(
        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs
    ) -> FixtureValue:
        if inspect.isgeneratorfunction(fixturefunc):
            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)
            generator = fixturefunc(**kwargs)
            try:
                fixture_result = next(generator)
            except StopIteration:
                raise ValueError(f"{request.fixturename} did not yield a value") from None
            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)
            request.addfinalizer(finalizer)
        else:
            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)
>           fixture_result = fixturefunc(**kwargs)
                             ^^^^^^^^^^^^^^^^^^^^^

.venv\Lib\site-packages\_pytest\fixtures.py:915: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

context = <conftest.context.<locals>.Context object at 0x000001CA70655340>

    @then('I should see a table with the following columns:')
    def step_see_table_with_columns(context):
        """
        Verify table has specified columns from Gherkin table parameter
        Generic step that works with any table - uses table framework to identify columns
    
        Args:
            context: Context fixture from conftest.py
            scenario: pytest-bdd scenario fixture that contains the table data
        """
        print(f"   >> Verifying table columns...")
    
        # Get expected column names from Gherkin table
        expected_columns = []
    
        # Try to access pytest-bdd's internal 'table' object via frame locals
        # This is how we can read the scenario table without needing a 'table' fixture.
        import inspect
        try:
            frame = inspect.currentframe()
            caller = frame.f_back if frame else None
            if caller and 'table' in caller.f_locals:
                gherkin_table = caller.f_locals['table']
                if gherkin_table:
                    for row in gherkin_table:
                        if isinstance(row, dict):
                            if 'Column Name' in row:
                                value = row['Column Name']
                            elif row:
                                value = list(row.values())[0]
                            else:
                                value = None
                        else:
                            value = str(row)
    
                        if value:
                            expected_columns.append(str(value).strip())
        finally:
            # Avoid reference cycles
            try:
                del frame
                del caller
            except Exception:
                pass
    
        if not expected_columns:
            # Fallback for frameworks where we can't introspect the Gherkin table easily.
            # Use the generic firm columns defined in maven_automation.feature.
            fallback_columns = ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
            print("   >> WARNING: No table data found via introspection, using fallback expected columns")
            expected_columns = fallback_columns
    
        print(f"   >> Expected columns from feature file (or fallback): {expected_columns}")
    
        if not expected_columns:
            raise AssertionError("No expected columns found in feature file table")
    
        # Ensure a table is identified first
        # If no table is in context, identify the first table
        try:
            summary = context.table_handler.get_table_summary()
            if not summary:
                print("   >> No table in context, identifying first table...")
                context.table_handler.identify_and_store("0", identifier_type='index')
                summary = context.table_handler.get_table_summary()
        except:
            print("   >> No table in context, identifying first table...")
            context.table_handler.identify_and_store("0", identifier_type='index')
            summary = context.table_handler.get_table_summary()
    
        if not summary:
>           raise AssertionError("No table found on the page. Make sure you are on a page with a table.")
E           AssertionError: No table found on the page. Make sure you are on a page with a table.

steps\table_steps.py:260: AssertionError

