================================================================================
TEST EXECUTION REPORT
================================================================================

Start Time: 2025-12-19 12:16:11
End Time: 2025-12-19 12:26:04
Duration: 0:09:52.761716

TOTAL TESTS: 11
PASSED: 7
FAILED: 4
SKIPPED: 0

================================================================================
PASSED TESTS:
================================================================================
1. test_admin_users_can_navigate_to_dedicated_admin_portal_login_page
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 38.52s

2. test_login_page_displays_email_and_password_fields
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 39.46s

3. test_forgot_password_link_redirects_to_password_reset_flow
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 2.16s

4. test_empty_email_field_shows_validation_error
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 42.63s

5. test_invalid_email_format_shows_validation_error
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 42.39s

6. test_admin_can_access_firms_section_and_view_firms_list
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 71.48s

7. test_admin_can_access_users_section_and_view_users_list_readonly
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 20.62s

================================================================================
FAILED TESTS:
================================================================================
1. test_admin_can_successfully_log_in
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 72.98s
   Error:
context = <conftest.context.<locals>.Context object at 0x0000017B707E4E60>

    @then('I should be redirected to the Admin Dashboard Home')
    @when('I should be redirected to the Admin Dashboard Home')
    def step_redirected_to_dashboard(context):
        """
        Verify redirect to Admin Dashboard Home
        Automatically gets URL from browser and waits for navigation
        Can be used as When or Then
        """
        print(f"   >> Verifying redirect to Admin Dashboard Home")
    
        # Get initial URL to detect navigation
        initial_url = context.driver.current_url.lower()
        print(f"   >> Initial URL: {initial_url}")
    
        try:
            from selenium.webdriver.support.ui import WebDriverWait
            from selenium.webdriver.support import expected_conditions as EC
            import time
    
            # Wait for URL to contain dashboard/admin/firms or not contain login
            wait = WebDriverWait(context.driver, 30)  # Wait up to 30 seconds for navigation
    
            # Wait for URL to change to dashboard/admin/firms
            def url_contains_dashboard_or_admin(driver):
                current_url = driver.current_url.lower()
                # Check if we're on dashboard, admin, or firms page (and not on login)
                if 'login' in current_url:
                    return False  # Still on login page, keep waiting
                # Check if we're on dashboard, admin, or firms page
                if 'dashboard' in current_url or 'admin' in current_url or 'firms' in current_url or 'users' in current_url:
                    return True
                # If URL changed from login page, consider it navigation (might be different URL structure)
                if current_url != initial_url and 'login' not in current_url:
                    return True
                return False
    
>           wait.until(url_contains_dashboard_or_admin)

steps\maven_steps.py:1434: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <selenium.webdriver.support.wait.WebDriverWait (session="1d89d925404af575c9041b433c99e20a")>
method = <function step_redirected_to_dashboard.<locals>.url_contains_dashboard_or_admin at 0x0000017B707A3600>, message = ''

    def until(self, method: Callable[[D], Literal[False] | T], message: str = "") -> T:
        """Wait until the method returns a value that is not False.
    
        Calls the method provided with the driver as an argument until the
        return value does not evaluate to ``False``.
    
        Args:
            method: A callable object that takes a WebDriver instance as an
                argument.
            message: Optional message for TimeoutException.
    
        Returns:
            The result of the last call to `method`.
    
        Raises:
            TimeoutException: If 'method' does not return a truthy value within
                the WebDriverWait object's timeout.
    
        Example:
            >>> from selenium.webdriver.common.by import By
            >>> from selenium.webdriver.support.ui import WebDriverWait
            >>> from selenium.webdriver.support import expected_conditions as EC
            >>>
            >>> # Wait until an element is visible on the page
            >>> wait = WebDriverWait(driver, 10)
            >>> element = wait.until(EC.visibility_of_element_located((By.ID, "exampleId")))
            >>> print(element.text)
        """
        screen = None
        stacktrace = None
    
        end_time = time.monotonic() + self._timeout
        while True:
            try:
                value = method(self._driver)
                if value:
                    return value
            except self._ignored_exceptions as exc:
                screen = getattr(exc, "screen", None)
                stacktrace = getattr(exc, "stacktrace", None)
            if time.monotonic() > end_time:
                break
            time.sleep(self._poll)
>       raise TimeoutException(message, screen, stacktrace)
E       selenium.common.exceptions.TimeoutException: Message:

.venv\Lib\site-packages\selenium\webdriver\support\wait.py:122: TimeoutException

During handling of the above exception, another exception occurred:

fixturefunc = <function step_redirected_to_dashboard at 0x0000017B704F8B80>, request = <FixtureRequest for <Function test_admin_can_successfully_log_in>>
kwargs = {'context': <conftest.context.<locals>.Context object at 0x0000017B707E4E60>}

    def call_fixture_func(
        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs
    ) -> FixtureValue:
        if inspect.isgeneratorfunction(fixturefunc):
            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)
            generator = fixturefunc(**kwargs)
            try:
                fixture_result = next(generator)
            except StopIteration:
                raise ValueError(f"{request.fixturename} did not yield a value") from None
            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)
            request.addfinalizer(finalizer)
        else:
            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)
>           fixture_result = fixturefunc(**kwargs)
                             ^^^^^^^^^^^^^^^^^^^^^

.venv\Lib\site-packages\_pytest\fixtures.py:915: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

context = <conftest.context.<locals>.Context object at 0x0000017B707E4E60>

    @then('I should be redirected to the Admin Dashboard Home')
    @when('I should be redirected to the Admin Dashboard Home')
    def step_redirected_to_dashboard(context):
        """
        Verify redirect to Admin Dashboard Home
        Automatically gets URL from browser and waits for navigation
        Can be used as When or Then
        """
        print(f"   >> Verifying redirect to Admin Dashboard Home")
    
        # Get initial URL to detect navigation
        initial_url = context.driver.current_url.lower()
        print(f"   >> Initial URL: {initial_url}")
    
        try:
            from selenium.webdriver.support.ui import WebDriverWait
            from selenium.webdriver.support import expected_conditions as EC
            import time
    
            # Wait for URL to contain dashboard/admin/firms or not contain login
            wait = WebDriverWait(context.driver, 30)  # Wait up to 30 seconds for navigation
    
            # Wait for URL to change to dashboard/admin/firms
            def url_contains_dashboard_or_admin(driver):
                current_url = driver.current_url.lower()
                # Check if we're on dashboard, admin, or firms page (and not on login)
                if 'login' in current_url:
                    return False  # Still on login page, keep waiting
                # Check if we're on dashboard, admin, or firms page
                if 'dashboard' in current_url or 'admin' in current_url or 'firms' in current_url or 'users' in current_url:
                    return True
                # If URL changed from login page, consider it navigation (might be different URL structure)
                if current_url != initial_url and 'login' not in current_url:
                    return True
                return False
    
            wait.until(url_contains_dashboard_or_admin)
            current_url = context.driver.current_url
            print(f"   >> Navigation detected: {current_url}")
    
            # Wait for page to be fully loaded
            wait.until(lambda driver: driver.execute_script('return document.readyState') == 'complete')
            print(f"   >> Page ready state complete")
    
            # Additional wait for dynamic content
            import time
            time.sleep(2)  # Wait for dynamic content to load
            print(f"   >> Dynamic content loaded")
    
            current_url_lower = current_url.lower()
            # Verify we're not on login page
            assert 'login' not in current_url_lower, \
                f"Still on login page. Current URL: {current_url}"
    
            # Set global login state for session reuse (happy case login)
            try:
                from conftest import _login_state
                _login_state['logged_in'] = True
                _login_state['login_url'] = current_url
                context.logged_in = True
                print(f"   >> Login state set for session reuse")
            except:
                context.logged_in = True
    
            print(f"   >> Redirected to Admin Dashboard Home (URL: {current_url})")
        except Exception as e:
            current_url = context.driver.current_url.lower()
            print(f"   >> Error waiting for redirect: {str(e)}")
            print(f"   >> Current URL: {context.driver.current_url}")
    
            # Check if we're actually on a valid page (not login)
            if 'login' not in current_url:
                # We're not on login page, so navigation likely succeeded
                print(f"   >> Not on login page - navigation likely succeeded")
                # Still verify we're on a valid admin page
                assert ('dashboard' in current_url or 'admin' in current_url or 'firms' in current_url or 'users' in current_url), \
                    f"Not on expected Admin Dashboard page. Current URL: {context.driver.current_url}"
    
                # Set global login state for session reuse (happy case login)
                try:
                    from conftest import _login_state
                    _login_state['logged_in'] = True
                    _login_state['login_url'] = context.driver.current_url
                    context.logged_in = True
                    print(f"   >> Login state set for session reuse")
                except:
                    context.logged_in = True
    
                print(f"   >> Redirected to Admin Dashboard Home (URL: {context.driver.current_url})")
            else:
                # Still on login page - navigation failed
>               assert False, f"Not redirected to Admin Dashboard. Still on login page. Current URL: {context.driver.current_url}"
                       ^^^^^
E               AssertionError: Not redirected to Admin Dashboard. Still on login page. Current URL: https://dev-admin.maventech.ai/login

steps\maven_steps.py:1489: AssertionError

2. test_admin_lands_on_admin_panel_dashboard__firms_view_by_default
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 105.99s
   Error:
fixturefunc = <function step_should_be_on_firms_page_default at 0x0000017B705168E0>
request = <FixtureRequest for <Function test_admin_lands_on_admin_panel_dashboard__firms_view_by_default>>
kwargs = {'context': <conftest.context.<locals>.Context object at 0x0000017B7080F7D0>}

    def call_fixture_func(
        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs
    ) -> FixtureValue:
        if inspect.isgeneratorfunction(fixturefunc):
            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)
            generator = fixturefunc(**kwargs)
            try:
                fixture_result = next(generator)
            except StopIteration:
                raise ValueError(f"{request.fixturename} did not yield a value") from None
            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)
            request.addfinalizer(finalizer)
        else:
            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)
>           fixture_result = fixturefunc(**kwargs)
                             ^^^^^^^^^^^^^^^^^^^^^

.venv\Lib\site-packages\_pytest\fixtures.py:915: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

context = <conftest.context.<locals>.Context object at 0x0000017B7080F7D0>

    @then('I should be on the Firms list page by default')
    def step_should_be_on_firms_page_default(context):
        """
        Verify we are on the Firms list page by default
        """
        print(f"   >> Verifying on Firms list page by default")
        current_url = context.driver.current_url.lower()
>       assert 'firms' in current_url, f"Not on Firms list page. Current URL: {current_url}"
               ^^^^^^^^^^^^^^^^^^^^^^
E       AssertionError: Not on Firms list page. Current URL: https://dev-admin.maventech.ai/login

steps\maven_steps.py:2569: AssertionError

3. test_firms_list_displays_all_required_columns
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 7.66s
   Error:
fixturefunc = <function step_verify_row_details at 0x0000017B706539C0>, request = <FixtureRequest for <Function test_firms_list_displays_all_required_columns>>
kwargs = {'context': <conftest.context.<locals>.Context object at 0x0000017B70891DC0>, 'entity_type': 'firm'}

    def call_fixture_func(
        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs
    ) -> FixtureValue:
        if inspect.isgeneratorfunction(fixturefunc):
            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)
            generator = fixturefunc(**kwargs)
            try:
                fixture_result = next(generator)
            except StopIteration:
                raise ValueError(f"{request.fixturename} did not yield a value") from None
            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)
            request.addfinalizer(finalizer)
        else:
            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)
>           fixture_result = fixturefunc(**kwargs)
                             ^^^^^^^^^^^^^^^^^^^^^

.venv\Lib\site-packages\_pytest\fixtures.py:915: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

context = <conftest.context.<locals>.Context object at 0x0000017B70891DC0>, entity_type = 'firm', scenario = None

    @then(parsers.parse('each row should display these details'))
    @then(parsers.parse('each {entity_type} row should display these details'))
    def step_verify_row_details(context, entity_type=None, scenario=None):
        """
        Verify that each row in the table displays the expected details
        Generic step that works with any table - checks that rows have data in expected columns
    
        Args:
            context: Context fixture from conftest.py
            entity_type: Optional entity type (e.g., 'firm', 'user') - for readability only
            scenario: pytest-bdd scenario fixture (optional, for future table data)
        """
        entity_text = f"{entity_type} " if entity_type else ""
        print(f"   >> Verifying that each {entity_text}row displays expected details...")
    
        # Get expected columns from previous step or from context
        expected_columns = getattr(context, 'expected_columns', None)
        if not expected_columns:
            # Try to get from table summary
            summary = context.table_handler.get_table_summary()
            if summary:
                expected_columns = summary.get('headers', [])
                expected_columns = [h.strip() for h in expected_columns if h and h.strip()]
    
        if not expected_columns:
            raise AssertionError("No expected columns found. Make sure to verify columns first with 'I should see a table with the following columns'")
    
        # Read all rows from table
        rows = context.table_handler.read_all_rows()
        if not rows:
            raise AssertionError("Table has no data rows")
    
        print(f"   >> Checking {len(rows)} rows for {len(expected_columns)} expected columns...")
    
        # Verify each row has data in expected columns
        rows_with_missing_data = []
        for row_index, row in enumerate(rows):
            missing_data = []
            for col in expected_columns:
                # Find matching column in row (case-insensitive)
                row_value = None
                for key, value in row.items():
                    if col.strip().lower() == key.strip().lower():
                        row_value = value
                        break
                    # Try partial match
                    if col.strip().lower() in key.strip().lower() or key.strip().lower() in col.strip().lower():
                        row_value = value
                        break
    
                # Check if value exists and is not empty
                if not row_value or (isinstance(row_value, str) and not row_value.strip()):
                    missing_data.append(col)
    
            if missing_data:
                rows_with_missing_data.append({
                    'row_index': row_index,
                    'row_data': row,
                    'missing_columns': missing_data
                })
                print(f"   >> ✗ Row {row_index} missing data in: {missing_data}")
            else:
                print(f"   >> ✓ Row {row_index} has all expected data")
    
        if rows_with_missing_data:
            error_msg = f"Found {len(rows_with_missing_data)} row(s) with missing data:\n"
            for issue in rows_with_missing_data[:5]:  # Show first 5 issues
                error_msg += f"  Row {issue['row_index']}: missing {issue['missing_columns']}\n"
            if len(rows_with_missing_data) > 5:
                error_msg += f"  ... and {len(rows_with_missing_data) - 5} more\n"
>           raise AssertionError(error_msg)
E           AssertionError: Found 8 row(s) with missing data:
E             Row 0: missing ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
E             Row 1: missing ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
E             Row 2: missing ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
E             Row 3: missing ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
E             Row 4: missing ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
E             ... and 3 more

steps\table_steps.py:449: AssertionError

4. test_admin_can_create_a_new_firm_with_owner
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 146.01s
   Error:
E   pytest_bdd.exceptions.StepDefinitionNotFoundError: Step definition is not found: When "I fill in all mandatory fields:". Line 108 in scenario "Admin can create a new firm with owner" in the feature "C:\Users\wishma.khurram\work\Ant Design\features\maven_automation.feature"
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.

