================================================================================
TEST EXECUTION REPORT
================================================================================

Start Time: 2025-12-31 10:52:43
End Time: 2025-12-31 10:58:24
Duration: 0:05:41.659013

TOTAL TESTS: 11
PASSED: 9
FAILED: 2
SKIPPED: 0

================================================================================
PASSED TESTS:
================================================================================
1. test_admin_users_can_navigate_to_dedicated_admin_portal_login_page
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 39.57s

2. test_login_page_displays_email_and_password_fields
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 40.38s

3. test_forgot_password_link_redirects_to_password_reset_flow
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 28.88s

4. test_empty_email_field_shows_validation_error
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 52.85s

5. test_invalid_email_format_shows_validation_error
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 53.23s

6. test_admin_can_successfully_log_in
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 62.29s

7. test_admin_lands_on_admin_panel_dashboard__firms_view_by_default
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 5.25s

8. test_admin_can_access_firms_section_and_view_firms_list
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 20.23s

9. test_admin_can_access_users_section_and_view_users_list_readonly
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 20.68s

================================================================================
FAILED TESTS:
================================================================================
1. test_firms_list_displays_all_required_columns
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 6.87s
   Error:
fixturefunc = <function step_verify_row_details at 0x000001CB8EC90860>
request = <FixtureRequest for <Function test_firms_list_displays_all_required_columns>>
kwargs = {'context': <conftest.context.<locals>.Context object at 0x000001CB8F262C90>, 'entity_type': 'firm'}

    def call_fixture_func(
        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs
    ) -> FixtureValue:
        if inspect.isgeneratorfunction(fixturefunc):
            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)
            generator = fixturefunc(**kwargs)
            try:
                fixture_result = next(generator)
            except StopIteration:
                raise ValueError(f"{request.fixturename} did not yield a value") from None
            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)
            request.addfinalizer(finalizer)
        else:
            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)
>           fixture_result = fixturefunc(**kwargs)
                             ^^^^^^^^^^^^^^^^^^^^^

.venv\Lib\site-packages\_pytest\fixtures.py:915: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

context = <conftest.context.<locals>.Context object at 0x000001CB8F262C90>, entity_type = 'firm', scenario = None

    @then(parsers.parse('each row should display these details'))
    @then(parsers.parse('each {entity_type} row should display these details'))
    def step_verify_row_details(context, entity_type=None, scenario=None):
        """
        Verify that each row in the table displays the expected details
        Generic step that works with any table - checks that rows have data in expected columns
    
        Args:
            context: Context fixture from conftest.py
            entity_type: Optional entity type (e.g., 'firm', 'user') - for readability only
            scenario: pytest-bdd scenario fixture (optional, for future table data)
        """
        entity_text = f"{entity_type} " if entity_type else ""
        print(f"   >> Verifying that each {entity_text}row displays expected details...")
    
        # Get expected columns from previous step or from context
        expected_columns = getattr(context, 'expected_columns', None)
        if not expected_columns:
            # Try to get from table summary
            summary = context.table_handler.get_table_summary()
            if summary:
                expected_columns = summary.get('headers', [])
                expected_columns = [h.strip() for h in expected_columns if h and h.strip()]
    
        if not expected_columns:
            raise AssertionError("No expected columns found. Make sure to verify columns first with 'I should see a table with the following columns'")
    
        # Read all rows from table
        rows = context.table_handler.read_all_rows()
        if not rows:
            raise AssertionError("Table has no data rows")
    
        print(f"   >> Checking {len(rows)} rows for {len(expected_columns)} expected columns...")
    
        # Verify each row has data in expected columns
        rows_with_missing_data = []
        for row_index, row in enumerate(rows):
            missing_data = []
            for col in expected_columns:
                # Find matching column in row (case-insensitive)
                row_value = None
                for key, value in row.items():
                    if col.strip().lower() == key.strip().lower():
                        row_value = value
                        break
                    # Try partial match
                    if col.strip().lower() in key.strip().lower() or key.strip().lower() in col.strip().lower():
                        row_value = value
                        break
    
                # Check if value exists and is not empty
                if not row_value or (isinstance(row_value, str) and not row_value.strip()):
                    missing_data.append(col)
    
            if missing_data:
                rows_with_missing_data.append({
                    'row_index': row_index,
                    'row_data': row,
                    'missing_columns': missing_data
                })
                print(f"   >> ✗ Row {row_index} missing data in: {missing_data}")
            else:
                print(f"   >> ✓ Row {row_index} has all expected data")
    
        if rows_with_missing_data:
            error_msg = f"Found {len(rows_with_missing_data)} row(s) with missing data:\n"
            for issue in rows_with_missing_data[:5]:  # Show first 5 issues
                error_msg += f"  Row {issue['row_index']}: missing {issue['missing_columns']}\n"
            if len(rows_with_missing_data) > 5:
                error_msg += f"  ... and {len(rows_with_missing_data) - 5} more\n"
>           raise AssertionError(error_msg)
E           AssertionError: Found 8 row(s) with missing data:
E             Row 0: missing ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
E             Row 1: missing ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
E             Row 2: missing ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
E             Row 3: missing ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
E             Row 4: missing ['Firm Name', 'Status', 'Email', 'Phone', 'Website', 'Date Created', 'Action']
E             ... and 3 more

steps\table_steps.py:449: AssertionError

2. test_admin_can_create_a_new_firm_with_owner
   File: .venv\Lib\site-packages\pytest_bdd\scenario.py
   Line: 295
   Duration: 8.75s
   Error:
fixturefunc = <function step_fill_all_mandatory_fields at 0x000001CB8EB2B920>
request = <FixtureRequest for <Function test_admin_can_create_a_new_firm_with_owner>>
kwargs = {'context': <conftest.context.<locals>.Context object at 0x000001CB8F2A7050>}

    def call_fixture_func(
        fixturefunc: _FixtureFunc[FixtureValue], request: FixtureRequest, kwargs
    ) -> FixtureValue:
        if inspect.isgeneratorfunction(fixturefunc):
            fixturefunc = cast(Callable[..., Generator[FixtureValue]], fixturefunc)
            generator = fixturefunc(**kwargs)
            try:
                fixture_result = next(generator)
            except StopIteration:
                raise ValueError(f"{request.fixturename} did not yield a value") from None
            finalizer = functools.partial(_teardown_yield_fixture, fixturefunc, generator)
            request.addfinalizer(finalizer)
        else:
            fixturefunc = cast(Callable[..., FixtureValue], fixturefunc)
>           fixture_result = fixturefunc(**kwargs)
                             ^^^^^^^^^^^^^^^^^^^^^

.venv\Lib\site-packages\_pytest\fixtures.py:915: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

context = <conftest.context.<locals>.Context object at 0x000001CB8F2A7050>, table = None

                context.button_clicked = context.button_handler.click_button(button_text, identifier_type='auto')
                if context.button_clicked:
                    print(f"   >> ✓ Successfully clicked button: '{button_text}'")
                    break
                time.sleep(0.2)
    
        assert context.button_clicked, f"Failed to click Add Firm button using data-attr-id or text search"
        print(f"   >> Add Firm button clicked successfully")
        time.sleep(0.5)  # Reduced delay for faster execution
    
    
    @when('I fill in all mandatory fields:')
    def step_fill_all_mandatory_fields(context, table=None):
        """
        Fill in all mandatory fields from a Gherkin table
        Table format: | Field | Value |
        pytest-bdd automatically injects the table parameter, but we also support frame introspection as fallback
        """
        print(f"   >> Filling in all mandatory fields...")
    
        # Clear pattern cache to ensure fresh patterns for the form page
        try:
            context.pattern_discovery.clear_cache()
            print(f"   >> Cleared pattern cache for fresh form patterns")
        except Exception as e:
            print(f"   >> Could not clear pattern cache: {str(e)}")
    
        # Get table data - try multiple methods
        table_data = []
        gherkin_table = None
    
        # Method 1: Try table parameter (pytest-bdd injects this automatically)
        if table:
            gherkin_table = table
            print(f"   >> Using table from pytest-bdd parameter")
        else:
            # Method 2: Try frame introspection (search multiple frames)
            try:
                import inspect
                stack = inspect.stack()
                print(f"   >> Searching through {len(stack)} stack frames for table...")
                for idx, frame_info in enumerate(stack):
                    frame = frame_info.frame
                    # Check all local variables in this frame
                    if 'table' in frame.f_locals:
                        potential_table = frame.f_locals['table']
                        # Verify it's a table-like object (iterable, not string)
                        if potential_table and hasattr(potential_table, '__iter__') and not isinstance(potential_table, (str, bytes)):
                            try:
                                # Try to get first item to verify it's a table
                                test_iter = iter(potential_table)
                                first_item = next(test_iter, None)
                                if first_item and (isinstance(first_item, dict) or (hasattr(first_item, '__iter__') and not isinstance(first_item, str))):
                                    gherkin_table = potential_table
                                    print(f"   >> Found table in stack frame {idx} ({frame_info.function}): {frame_info.filename}")
                                    break
                            except:
                                pass
                # Clean up frame references
                try:
                    del stack
                except:
                    pass
            except Exception as e:
                print(f"   >> Could not get table from frame introspection: {str(e)}")
                import traceback
>               traceback.print_exc()
E               AssertionError: No table data found! The Gherkin table must be provided in the feature file.

steps\maven_steps.py:2911: AssertionError

